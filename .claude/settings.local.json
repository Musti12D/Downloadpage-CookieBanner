{
  "permissions": {
    "allow": [
      "Bash(ls -la /Users/mustafaerdal/Desktop/Mira-Claude/*.html)",
      "Bash(xargs -I {} basename {})",
      "Bash(find \"/Users/mustafaerdal/Desktop/Mira-Claude\" -type f \\\\\\( -name \"*.node\" -o -name \"binding.gyp\" -o -name \"native*\" \\\\\\) 2>/dev/null | head -20)",
      "Bash(swiftc ax-helper.swift -O -o resources/ax-helper 2>&1)",
      "Bash(./resources/ax-helper list --bundle \"com.apple.finder\" 2>&1 | python3 -c \"import json,sys; d=json.load\\(sys.stdin\\); [print\\(f\\\\\"{e['role']:20} | {e['title'][:40]:40} | {e['label'][:30]:30} | x:{e['x']} y:{e['y']}\\\\\"\\) for e in d['elements'][:30]]; print\\(f\\\\\"Total: {d['count']}\\\\\"\\)\")",
      "Bash(swiftc ax-helper.swift -O -o resources/ax-helper 2>&1 && echo \"OK\" && ./resources/ax-helper focused)",
      "Bash(node --check /Users/mustafaerdal/Desktop/Mira-Claude/context-manager.js && echo \"context-manager.js OK\" && node --check /Users/mustafaerdal/Desktop/Mira-Claude/ax-layer.js && echo \"ax-layer.js OK\")",
      "Bash(node -e \"\nconst cm = require\\('./context-manager'\\);\n// Simulate a state capture \\(no Electron, will get 'no_app' but shouldn't crash\\)\nconst state = cm.captureState\\(\\);\nconsole.log\\('empty:', state.empty\\);\nconsole.log\\('toPromptString:', cm.toPromptString\\(state\\) || '\\(leer — erwartet ohne App\\)'\\);\nconsole.log\\('findInState null:', cm.findInState\\(state, 'test'\\)\\);\nconsole.log\\('toShortString:', cm.toShortString\\(state\\)\\);\nconsole.log\\('OK'\\);\n\" 2>&1)",
      "Bash(node --check ax-layer.js && node --check context-manager.js && echo \"Syntax OK\")",
      "Bash(node -e \"\nconst axl = require\\('./ax-layer'\\);\n// Platform detection\nconsole.log\\('Platform:', process.platform\\);\nconsole.log\\('Helper path \\(dev\\):', axl._getHelperPath\\(\\)\\);\nconsole.log\\('Permission:', axl.isPermissionGranted\\(\\)\\);\n\n// Test frontmost \\(Mac\\)\nconst app = axl.getFrontmostApp\\(\\);\nconsole.log\\('Frontmost:', JSON.stringify\\(app\\)\\);\nconsole.log\\('OK'\\);\n\" 2>&1)",
      "Bash(node -e \"\nconst cm = require\\('./context-manager'\\);\n// Windows process name lookup\nconst testCases = ['EXCEL', 'chrome', 'WINWORD', 'explorer', 'OUTLOOK'];\nconst { BUNDLE_TO_TYPE } = require\\('./context-manager'\\).__proto__.constructor;\n// Test via actual context capture\nconst state = cm.captureState\\(true\\);\nconsole.log\\('App type \\(live\\):', state.appType\\);\nconsole.log\\('Context:', state.context || '\\(none\\)'\\);\n// Check Windows keys exist in the module\nconst src = require\\('fs'\\).readFileSync\\('./context-manager.js', 'utf8'\\);\ntestCases.forEach\\(k => {\n  const found = src.includes\\(\\\\\"'\\\\\" + k + \\\\\"'\\\\\"\\);\n  console.log\\(k + ':', found ? 'FOUND' : 'MISSING'\\);\n}\\);\nconsole.log\\('OK'\\);\n\" 2>&1)",
      "Bash(echo \"=== New files ===\" && ls -lh ax-helper.swift ax-helper-win/ ax-layer.js context-manager.js resources/ax-helper 2>/dev/null && echo \"\" && echo \"=== ax-helper-win/ ===\" && ls ax-helper-win/ && echo \"\" && echo \"=== package.json build:ax-win ===\" && node -e \"const p=require\\('./package.json'\\); console.log\\(p.scripts['build:ax-win']\\)\")",
      "Bash(node --check scripts/build-all.js && echo \"Syntax OK\")",
      "Bash(node scripts/build-all.js 2>&1 | head -40)",
      "Bash(node -e \"\n// Simulate --win flag behavior without actually running electron-builder\nprocess.argv.push\\('--win'\\);\nconst fs = require\\('fs'\\);\nconst path = require\\('path'\\);\nconst AX_WIN = path.join\\(__dirname, 'resources', 'ax-helper-win.exe'\\);\nconst winExists = fs.existsSync\\(AX_WIN\\);\nconsole.log\\('--win flag detected:', true\\);\nconsole.log\\('ax-helper-win.exe exists:', winExists\\);\nconsole.log\\('Expected behavior: fail with clear error since binary is missing'\\);\n\")",
      "Bash(node scripts/build-all.js --win 2>&1 | head -20)",
      "Bash(node --check /Users/mustafaerdal/Desktop/Mira-Claude/main.js && echo \"main.js: OK\"\nnode --check /Users/mustafaerdal/Desktop/Mira-Claude/context-manager.js && echo \"context-manager.js: OK\")",
      "Bash(node --check main.js && echo \"main.js OK\" && node --check coord-cache.js && echo \"coord-cache.js OK\" && node --check mail-monitor.js && echo \"mail-monitor.js OK\" && node --check recovery-engine.js && echo \"recovery-engine.js OK\")",
      "Bash(node -e \"\nconst brain = require\\('/Users/mustafaerdal/Desktop/Mira-Claude/mira-brain.js'\\);\n// Test findTrigger with empty KB \\(default\\)\nconst t = brain.findTrigger\\('new_mail', { subject: 'Rechnung' }\\);\nconsole.log\\('findTrigger \\(empty\\):', t\\);\n// Test checkLimit\nconst l = brain.checkLimit\\('send_mail'\\);\nconsole.log\\('checkLimit:', l\\);\n// Test buildPromptContext empty\nconst ctx = brain.buildPromptContext\\(\\);\nconsole.log\\('promptContext empty:', JSON.stringify\\(ctx\\)\\);\nconsole.log\\('OK'\\);\n\" 2>&1)",
      "Bash(node -e \"\n// Verify all required files exist\nconst fs = require\\('fs'\\);\nconst files = [\n  'mira-brain.js',\n  'mira-brain.js',\n  'supabase-migration-knowledge-base.sql',\n  'api-kb-routes.js',\n  'knowledge-base-overlay.html',\n];\nfiles.forEach\\(f => {\n  const exists = fs.existsSync\\('/Users/mustafaerdal/Desktop/Mira-Claude/' + f\\);\n  console.log\\(\\(exists ? '✅' : '❌'\\) + ' ' + f\\);\n}\\);\n\" 2>&1)",
      "Bash(node -e \"\n// Check main.js has all the new pieces\nconst src = require\\('fs'\\).readFileSync\\('/Users/mustafaerdal/Desktop/Mira-Claude/main.js', 'utf8'\\);\nconst checks = [\n  [\\\\\"require\\('./mira-brain'\\)\\\\\", 'mira-brain require'],\n  ['knowledgeBaseWindow', 'knowledgeBaseWindow variable'],\n  ['createKnowledgeBaseWindow', 'createKnowledgeBaseWindow function'],\n  ['miraBrain.configure', 'miraBrain.configure in startPolling'],\n  ['miraBrain.start', 'miraBrain.start'],\n  ['miraBrain.stop', 'miraBrain.stop'],\n  ['miraBrain.findTrigger', 'findTrigger in handleNewMail'],\n  ['miraBrain.lookupContact', 'lookupContact in handleNewMail'],\n  ['miraBrain.buildPromptContext', 'buildPromptContext in handleNewMail'],\n  [\\\\\"ipcMain.handle\\('kb-load'\\\\\", 'kb-load IPC'],\n  [\\\\\"ipcMain.handle\\('kb-save'\\\\\", 'kb-save IPC'],\n  [\\\\\"ipcMain.handle\\('kb-open'\\\\\", 'kb-open IPC'],\n  [\\\\\"ipcMain.handle\\('kb-close'\\\\\", 'kb-close IPC'],\n];\nchecks.forEach\\(\\([needle, label]\\) => {\n  console.log\\(\\(src.includes\\(needle\\) ? '✅' : '❌'\\) + ' ' + label\\);\n}\\);\n\" 2>&1)",
      "Bash(find /Users/mustafaerdal -maxdepth 5 -name \"*.js\" 2>/dev/null | xargs grep -l \"mira_tokens\\\\|server-mira\" 2>/dev/null | grep -v node_modules | head -10)",
      "Bash(find /Users/mustafaerdal -maxdepth 6 -name \"*.js\" 2>/dev/null | xargs grep -l \"agent/poll\\\\|resolve-step\\\\|cancel-pending\" 2>/dev/null | grep -v node_modules | head -10)",
      "Bash(find /Users/mustafaerdal -maxdepth 3 -name \"*.env\" -o -name \".env*\" 2>/dev/null | grep -v node_modules | head -10)",
      "Bash(which supabase 2>/dev/null && supabase --version 2>/dev/null || echo \"not installed\")",
      "Bash(node -e \"\nconst brain = require\\('/Users/mustafaerdal/Desktop/Mira-Claude/mira-brain.js'\\);\n// Test needsOnboarding on fresh \\(unconfigured\\) instance\nconsole.log\\('needsOnboarding \\(fresh\\):', brain.needsOnboarding\\(\\)\\); // should be true\n\n// Test generateFromOnboarding \\(without save, just the logic\\)\nconst orig = brain.save.bind\\(brain\\);\nbrain.save = async \\(kb\\) => { brain._kb = kb; brain._loadedAt = Date.now\\(\\); };\nbrain.generateFromOnboarding\\({ industry: 'handel', tasks: ['emails', 'rechnungen', 'bestellungen'], apps: [] }\\).then\\(r => {\n  console.log\\('Triggers:', r.triggerCount, '| Limits:', r.limitCount\\);\n  console.log\\('needsOnboarding \\(after\\):', brain.needsOnboarding\\(\\)\\); // should be false\n  const kb = brain.get\\(\\);\n  console.log\\('Role:', kb.context.role\\);\n  console.log\\('First trigger:', kb.triggers[0]?.route_name\\);\n  console.log\\('First limit:', kb.limits[0]?.action, '— auto:', kb.limits[0]?.autonomous\\);\n  console.log\\('OK'\\);\n}\\);\n\" 2>&1)",
      "Bash(node -e \"\nconst src = require\\('fs'\\).readFileSync\\('/Users/mustafaerdal/Desktop/Mira-Claude/main.js', 'utf8'\\);\nconst lines = src.split\\('\\\\n'\\);\n// Find the closing of executeTaskFromQueue \\(outer try/catch block\\)\nlet depth = 0; let started = false; let startLine = 599; // line 600 \\(0-indexed 599\\)\nfor \\(let i = startLine; i < Math.min\\(startLine+500, lines.length\\); i++\\) {\n  const l = lines[i];\n  depth += \\(l.match\\(/\\\\\\\\{/g\\)||[]\\).length - \\(l.match\\(/\\\\\\\\}/g\\)||[]\\).length;\n  if \\(!started && depth > 0\\) started = true;\n  if \\(started && depth === 0\\) { console.log\\('outer try/catch ends at line:', i+1, '|', l.trim\\(\\)\\); break; }\n}\n\" 2>&1)",
      "Bash(node -e \"\nconst src = require\\('fs'\\).readFileSync\\('/Users/mustafaerdal/Desktop/Mira-Claude/main.js', 'utf8'\\);\nconst checks = [\n  ['_storeKey',                       'Fix 2: machine-specific encryption key'],\n  ['os.hostname\\(\\) + os.userInfo',     'Fix 2: key derived from hardware identity'],\n  ['encryptionKey: _storeKey',        'Fix 2: Store uses machine key'],\n  [\\\\\"invoke\\('check-ax-permission'\\)\\\\\",  'Fix 1: IPC handler registered'],\n  ['shell.openExternal',              'Fix 1: opens System Settings if denied'],\n  ['_pollFailCount',                  'Fix 4: offline failure counter'],\n  [\\\\\"send\\('agent-offline'\\)\\\\\",          'Fix 4: emits offline signal'],\n  [\\\\\"send\\('agent-online'\\)\\\\\",           'Fix 4: emits online signal'],\n];\nchecks.forEach\\(\\([needle, label]\\) => {\n  console.log\\(\\(src.includes\\(needle\\) ? '✅' : '❌'\\) + ' ' + label\\);\n}\\);\n\" 2>&1)",
      "Bash(node -e \"\nconst src = require\\('fs'\\).readFileSync\\('/Users/mustafaerdal/Desktop/Mira-Claude/main.js', 'utf8'\\);\n// The string uses single quotes around check-ax-permission\nconsole.log\\(src.includes\\(\\\\\"'check-ax-permission'\\\\\"\\) ? '✅ Fix 1: IPC handler registered' : '❌ missing'\\);\n\nconst html = require\\('fs'\\).readFileSync\\('/Users/mustafaerdal/Desktop/Mira-Claude/index.html', 'utf8'\\);\nconsole.log\\(html.includes\\('agent-offline'\\) ? '✅ Fix 4: index.html offline listener' : '❌ missing'\\);\nconsole.log\\(html.includes\\('agent-online'\\)  ? '✅ Fix 4: index.html online listener'  : '❌ missing'\\);\n\nconst ob = require\\('fs'\\).readFileSync\\('/Users/mustafaerdal/Desktop/Mira-Claude/onboarding-overlay.html', 'utf8'\\);\nconsole.log\\(ob.includes\\('check-ax-permission'\\) ? '✅ Fix 1: onboarding checks permission' : '❌ missing'\\);\nconsole.log\\(ob.includes\\('recheckPermission'\\)   ? '✅ Fix 1: recheck button'               : '❌ missing'\\);\nconsole.log\\(ob.includes\\('step-0'\\)              ? '✅ Fix 1: permission screen \\(step-0\\)'   : '❌ missing'\\);\n\nconst idx = require\\('fs'\\).readFileSync\\('/Users/mustafaerdal/index.js', 'utf8'\\);\nconsole.log\\(idx.includes\\('42P01'\\)           ? '✅ Fix 5: table-missing error detected'  : '❌ missing'\\);\nconsole.log\\(idx.includes\\('PGRST116'\\)        ? '✅ Fix 5: no-rows handled correctly'     : '❌ missing'\\);\nconsole.log\\(idx.includes\\('checkDatabaseReady'\\) || idx.includes\\('mira_knowledge_base'\\) && idx.includes\\('FATAL'\\)\n  ? '✅ Fix 5: startup DB check' : '❌ missing'\\);\n\nconst brain = require\\('fs'\\).readFileSync\\('/Users/mustafaerdal/Desktop/Mira-Claude/mira-brain.js', 'utf8'\\);\nconsole.log\\(brain.includes\\('DEFAULT_KB'\\) && brain.includes\\('freeze'\\) || brain.includes\\(\\\\\"don't freeze\\\\\"\\)\n  ? '✅ Fix 5: brain falls back to defaults' : \\(brain.includes\\('DEFAULT_KB'\\) ? '✅ Fix 5: brain falls back to defaults' : '❌ missing'\\)\\);\n\" 2>&1)",
      "Bash(node -e \"\nconst planner = require\\('/Users/mustafaerdal/Desktop/Mira-Claude/mira-planner.js'\\);\n// Basic API checks\nconsole.log\\('submitGoal:', typeof planner.submitGoal\\);\nconsole.log\\('remember:', typeof planner.remember\\);\nconsole.log\\('recall:', typeof planner.recall\\);\nconsole.log\\('start:', typeof planner.start\\);\nconsole.log\\('stop:', typeof planner.stop\\);\nconsole.log\\('init:', typeof planner.init\\);\n\n// Test that it doesn't crash when not initialized\nplanner.remember\\('event', 'test', 'test content'\\).then\\(\\(\\) => console.log\\('remember \\(uninited\\): silent ok'\\)\\);\nplanner.recall\\('test'\\).then\\(r => console.log\\('recall \\(uninited\\): []', JSON.stringify\\(r\\)\\)\\);\nconsole.log\\('Module OK'\\);\n\" 2>&1)",
      "Bash(node -e \"\nconst src = require\\('fs'\\).readFileSync\\('/Users/mustafaerdal/Desktop/Mira-Claude/main.js', 'utf8'\\);\n[\n  [\\\\\"require\\('./mira-planner'\\)\\\\\",   'planner require'],\n  ['miraPlanner.init',             'planner init in startPolling'],\n  ['miraPlanner.start\\(\\)',          'planner.start\\(\\)'],\n  ['miraPlanner.stop\\(\\)',           'planner.stop\\(\\) in stopPolling'],\n  ['executeTaskFromQueue\\(synthTask\\)', 'executeRoute uses synthetic task'],\n  [\\\\\"ipcMain.handle\\('goal-submit'\\\\\", 'goal-submit IPC'],\n  [\\\\\"ipcMain.handle\\('goal-recall'\\\\\", 'goal-recall IPC'],\n  ['miraPlanner.submitGoal',       'high-prio mails become goals'],\n].forEach\\(\\([n,l]\\) => console.log\\(\\(src.includes\\(n\\)?'✅':'❌'\\), l\\)\\);\n\nconst idx = require\\('fs'\\).readFileSync\\('/Users/mustafaerdal/index.js','utf8'\\);\n[\n  ['/api/brain/plan',              'plan endpoint'],\n  ['GET /api/brain/goals',         'goals GET'],\n  ['POST /api/brain/goals',        'goals POST'],\n  ['PATCH /api/brain/goals',       'goals PATCH'],\n  ['POST /api/brain/memory',       'memory POST'],\n  ['GET /api/brain/memory',        'memory GET'],\n  ['claude-sonnet-4-6',            'uses Sonnet for planning quality'],\n].forEach\\(\\([n,l]\\) => console.log\\(\\(idx.includes\\(n\\)?'✅':'❌'\\), l\\)\\);\n\" 2>&1)",
      "WebFetch(domain:getmira.space)"
    ]
  }
}
